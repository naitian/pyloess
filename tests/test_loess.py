"""Test loess function"""

import numpy as np
from pyloess import loess


def test_loess_nist():
    """Test loess function with NIST data and outputs

    https://www.itl.nist.gov/div898/handbook/pmd/section1/dep/dep144.htm
    """
    data = np.array(
        [
            [0.5578196, 18.63654],
            [2.0217271, 103.49646],
            [2.5773252, 150.35391],
            [3.4140288, 190.51031],
            [4.3014084, 208.70115],
            [4.7448394, 213.71135],
            [5.1073781, 228.49353],
            [6.5411662, 233.55387],
            [6.7216176, 234.55054],
            [7.2600583, 223.89225],
            [8.1335874, 227.68339],
            [9.1224379, 223.91982],
            [11.9296663, 168.01999],
            [12.3797674, 164.95750],
            [13.2728619, 152.61107],
            [14.2767453, 160.78742],
            [15.3731026, 168.55567],
            [15.6476637, 152.42658],
            [18.5605355, 221.70702],
            [18.5866354, 222.69040],
            [18.7572812, 243.18828],
        ]
    )

    out = loess(data[:, 0], data[:, 1], span=0.33, degree=1)
    expected_out = np.array(
        [
            20.59302,
            107.1603,
            139.7674,
            174.263,
            207.2334,
            216.6616,
            220.5445,
            229.8607,
            229.8347,
            229.4301,
            226.6045,
            220.3904,
            172.348,
            163.8417,
            161.849,
            160.3351,
            160.192,
            161.0556,
            227.34,
            227.8985,
            231.5586,
        ]
    )

    assert np.allclose(out[:, 1], expected_out), "Output does not match expected output"